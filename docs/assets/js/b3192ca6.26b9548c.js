"use strict";(globalThis.webpackChunk_jelper_website=globalThis.webpackChunk_jelper_website||[]).push([[5228],{9628(e,n,t){t.d(n,{Yb:()=>A,lC:()=>s,yK:()=>p,d7:()=>g,Um:()=>b,$$:()=>S,Bf:()=>w,aq:()=>d,gt:()=>f,JO:()=>h,xW:()=>l,wY:()=>B,ef:()=>D,nc:()=>i,BX:()=>u,Rx:()=>j,_g:()=>k,Z3:()=>C,RO:()=>y,iK:()=>m,UP:()=>a,h:()=>c});var r=t(82437);const s=e=>{const[n,t]=(0,r.useState)(e);return[n,(0,r.useCallback)(e=>{t(null==e?e=>!e:"boolean"==typeof e||"function"==typeof e?e:!!e)},[])]},a=(e,n)=>{const t=(0,r.useRef)(!1);(0,r.useEffect)(()=>{if(t.current)return e();t.current=!0},n)},o=(e,n)=>e===n,c=(e,n,t)=>{const{isEqual:s=o}=t||{},[c,l]=(0,r.useState)(e);return a(()=>{s(e,c)||null==n||n(c)},[c]),a(()=>{s(e,c)||l(e)},[e]),[c,l]},l=(e={})=>{const[n]=(0,r.useState)(e),[t,s]=(0,r.useState)(n),a=(0,r.useCallback)(()=>{s(n)},[n]),o=(0,r.useCallback)(e=>{s(n=>Object.assign(Object.assign({},n),"function"==typeof e?e(n):e))},[]);return[t,{setOption:s,reset:a,update:o}]},u=e=>{const n=(0,r.useRef)(e);return(0,r.useEffect)(()=>{n.current=e}),n},i=e=>{const n=u(e);return(0,r.useCallback)((...e)=>n.current(...e),[])},d=()=>{const e=(0,r.useRef)(!1);return(0,r.useEffect)(()=>(e.current=!0,()=>{e.current=!1}),[]),(0,r.useCallback)(()=>e.current,[])},f=()=>{const e=(0,r.useRef)(!0);return(0,r.useEffect)(()=>(e.current=!1,()=>{e.current=!0}),[]),(0,r.useCallback)(()=>e.current,[])},p=e=>{(0,r.useState)(e)},h=e=>{(0,r.useEffect)(e,[])},m=e=>{const n=u(e);(0,r.useEffect)(()=>()=>{n.current()},[])},b=(e,n=[],t)=>(0,r.useCallback)(n=>{var r;return"AbortError"===n.name?null===(r=null==t?void 0:t.onAbort)||void 0===r?void 0:r.call(t,n):e(n)},n);var v=t(8266);const g=(e,n=200,t)=>{const s=i(e);return(0,r.useMemo)(()=>(0,v.debounce)((...e)=>s(...e),n,t),[n,t])},k=(e,n=200,t)=>{const s=i(e);return(0,r.useMemo)(()=>(0,v.throttle)((...e)=>{s(...e)},n,t),[n,t])},j=()=>{const e=f();return(0,r.useCallback)((n,t)=>{e()?null==t||t():n()},[])},x={catchParam:!1},A=(e,n=Object.assign({},x))=>{const[t,s]=(0,r.useState)(void 0),[a,o]=(0,r.useState)(n.defParam||{}),[c,l]=(0,r.useState)(!1),[u,d]=(0,r.useState)(void 0),[f,p]=(0,r.useState)(),h=j();(0,r.useEffect)(()=>{if(!f||!n.onAbort)return;const e=n.onAbort;return f.signal.addEventListener("abort",e),()=>{f.signal.removeEventListener("abort",e)}},[f]);const b=i((t={})=>{const r=n.catchParam?Object.assign(Object.assign({},a),t):t;f&&f.abort();const c=new AbortController;return h(()=>{l(!0),d(void 0),p(c)}),e(r,{signal:c.signal}).then(e=>{c.signal.aborted||h(()=>{s(n.format?n.format(e):e),o(r)})},e=>{c.signal.aborted||h(()=>{d(e)})}).finally(()=>{h(()=>{l(!1),p(void 0)})})}),v=i(()=>b(a)),g=i(()=>{f&&(f.abort(),h(()=>{p(void 0),l(!1)}))});return m(()=>{f&&f.abort()}),[t,{run:b,refresh:v,cancel:g,loading:c,error:u,param:a,controller:f}]},y=()=>{const e=(0,r.useRef)(),n=(0,r.useCallback)(()=>{e.current&&(window.clearTimeout(e.current),e.current=void 0)},[]),t=(0,r.useCallback)((t,r,...s)=>{n(),e.current=window.setTimeout(()=>{e.current=void 0,t(...s)},r)},[]);return(0,r.useEffect)(()=>n),[t,n]},C=(e,n,...t)=>{const[s,a]=y(),o=i(e);return(0,r.useEffect)(()=>(s(o,n,...t),a),[o,n,...t]),a},w=()=>{const e=(0,r.useRef)(),n=(0,r.useCallback)(()=>{e.current&&(window.clearInterval(e.current),e.current=void 0)},[]),t=(0,r.useCallback)((t,r,...s)=>{n(),e.current=window.setInterval(()=>{t(...s)},r)},[]);return(0,r.useEffect)(()=>n),[t,n]},S=(e,n,...t)=>{const[s,a]=w(),o=i(e);return(0,r.useEffect)(()=>(s(o,n,...t),a),[o,n,...t]),a};let E,P,R=()=>{P=new Map,E=new window.ResizeObserver((e=[])=>{e.forEach((e={})=>{var n;null===(n=P.get(e.target))||void 0===n||n(e)})}),R=null};const T=(e,n)=>{R&&R(),e&&(P.set(e,n),E.observe(e))},O=e=>{R&&R(),e&&(E.unobserve(e),P.delete(e))},D=()=>[T,O],B=(e,n)=>{const t=(0,r.useCallback)(()=>{e.current&&O(e.current)},[e.current]);return(0,r.useEffect)(()=>{if(!e.current)return;const t=e.current;return T(t,n),()=>O(t)},[e.current,n]),t}},94131(e,n,t){t.r(n),t.d(n,{assets:()=>b,contentTitle:()=>m,default:()=>k,frontMatter:()=>h,metadata:()=>r,toc:()=>v});const r=JSON.parse('{"id":"hooks/useAsync/index","title":"useAsync","description":"\u5f02\u6b65\u51fd\u6570hooks\uff0c\u65b9\u4fbf\u6570\u636e\u5904\u7406\u548c\u6267\u884c","source":"@site/docs/hooks/useAsync/index.mdx","sourceDirName":"hooks/useAsync","slug":"/hooks/useAsync/","permalink":"/jelper/docs/hooks/useAsync/","draft":false,"unlisted":false,"editUrl":"https://github.com/apathyjade/jelper/tree/master/packages/docs/hooks/useAsync/index.mdx","tags":[],"version":"current","frontMatter":{"title":"useAsync","sort":1},"sidebar":"tutorialSidebar","previous":{"title":"hooks","permalink":"/jelper/docs/hooks/"},"next":{"title":"useBoolState","permalink":"/jelper/docs/hooks/useBoolState/"}}');var s=t(71137),a=t(99868),o=t(56374),c=t(44310),l=t(60799),u=(t(82437),t(62568)),i=t(15201),d=t(9628);const f=()=>new Promise(e=>{setTimeout(()=>{e("ok")},1500)}),p=()=>{const[e,n]=(0,d.Yb)(f,{immediate:!0}),[t,r]=(0,d.Yb)(f,{immediate:!1});return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(u.A,{spinning:n.loading,children:["data: ",e||"-"]}),(0,s.jsx)("br",{}),(0,s.jsxs)(u.A,{spinning:r.loading,children:["handleData: ",t||"-",(0,s.jsx)(i.Ay,{onClick:r.run,children:"\u83b7\u53d6\u6570\u636e"})]})]})},h={title:"useAsync",sort:1},m=void 0,b={},v=[{value:"\u5b89\u88c5",id:"\u5b89\u88c5",level:3},{value:"\u5f15\u5165",id:"\u5f15\u5165",level:3},{value:"\u6837\u4f8b",id:"\u6837\u4f8b",level:3},{value:"\u57fa\u7840\u7528\u6cd5",id:"\u57fa\u7840\u7528\u6cd5",level:4},{value:"API",id:"api",level:3},{value:"Interface",id:"interface",level:4}];function g(e){const n={code:"code",h3:"h3",h4:"h4",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"\u5f02\u6b65\u51fd\u6570hooks\uff0c\u65b9\u4fbf\u6570\u636e\u5904\u7406\u548c\u6267\u884c"}),"\n","\n",(0,s.jsx)(n.h3,{id:"\u5b89\u88c5",children:"\u5b89\u88c5"}),"\n",(0,s.jsx)(c.A,{name:"@jelper/hooks"}),"\n",(0,s.jsx)(n.h3,{id:"\u5f15\u5165",children:"\u5f15\u5165"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"import { useAsync } from '@jelper/hooks';\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u6837\u4f8b",children:"\u6837\u4f8b"}),"\n",(0,s.jsx)(n.h4,{id:"\u57fa\u7840\u7528\u6cd5",children:"\u57fa\u7840\u7528\u6cd5"}),"\n",(0,s.jsx)(o.A,{title:"\u57fa\u7840\u7528\u6cd5",desc:"",text:"\nimport React from 'react';\nimport { Spin, Button } from 'antd';\nimport { useAsync } from '@jelper/hooks';\n\n\nconst fetchData = () => {\n  return new Promise((r) => {\n    setTimeout(() => {\n      r('ok');\n    }, 1500)\n  })\n}\n\nexport default () => {\n  const [data, api] = useAsync(fetchData, { immediate: true });\n\n\n  const [handleData, handleApi] = useAsync(fetchData, { immediate: false });\n  return <>\n     <Spin spinning={api.loading}>\n      data: {data || '-'}\n    </Spin>\n    <br />\n     <Spin spinning={handleApi.loading}>\n      handleData: {handleData || '-'}\n      <Button onClick={handleApi.run}>\u83b7\u53d6\u6570\u636e</Button>\n    </Spin>\n  </>\n};\n",children:(0,s.jsx)(p,{})}),"\n",(0,s.jsx)(n.h3,{id:"api",children:"API"}),"\n",(0,s.jsx)(l.A,{dataSource:[{param:"useAsync",desc:"\u5f02\u6b65\u6267\u884c\u5e2e\u52a9hooks",type:"UseAsync",defValue:"--",version:""}]}),"\n",(0,s.jsx)(n.h4,{id:"interface",children:"Interface"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"interface Opt<T extends (p: any) => any, R> {\n  defParam?: Parameter<T>; // \u9ed8\u8ba4\u53c2\u6570\n  format?: (p: ReturnType<T>) => R; // \u683c\u5f0f\u5316\u8fd4\u56de\u6570\u636e\n  catchParam?: boolean;   // \u662f\u5426\u5408\u5e76\u8fd4\u56de\u503c\n  onAbort?: (this: AbortSignal, ev: Event) => any; // \u6267\u884c\u53d6\u6d88\u56de\u8c03\n}\n// \u9ed8\u8ba4\u4e0d\u4f1a\u6267\u884c\uff0c\u9700\u8981\u624b\u52a8\u8c03\u7528 run \u65b9\u6cd5\ntype UseAsync<T extends (p: any, opt?: { signal: AbortController['signal'] }) => Promise<any>, R = any> = (\n  asyncFn: T,\n  opt: Opt<T, R> = defOpt\n): [\n  R | undefined,  // \u8fd4\u56de\u6570\u636e\n  {\n    run: (runParam?: Partial<Parameter<T>>) => Promise<void>; // \u6267\u884c\u65b9\u6cd5\n    refresh: () => Promise<void>; // \u4f7f\u7528\u4e0a\u4e00\u6b21 \u53c2\u6570 \u6267\u884c\u65b9\u6cd5\n    loading: boolean; // \u52a0\u8f7d\u72b6\u6001\n    error?: Error; // \u5f02\u5e38\u6570\u636e\n    param: Partial<Parameter<T>>; // \u5f53\u524d\u7ed3\u679c\u53c2\u6570\n    controller: AbortController|undefined; // AbortController\u5b9e\u4f8b\u53ef\u624b\u52a8\u53d6\u6d88\u6267\u884c\u56de\u8c03\n  }\n]\n"})})]})}function k(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(g,{...e})}):g(e)}}}]);