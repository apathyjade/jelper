"use strict";(self.webpackChunk_jelper_website=self.webpackChunk_jelper_website||[]).push([[5228],{3612:(e,n,t)=>{t.d(n,{Yb:()=>G,lC:()=>o,yK:()=>p,d7:()=>L,Um:()=>h,$$:()=>ne,Bf:()=>ee,aq:()=>d,gt:()=>f,JO:()=>m,xW:()=>c,wY:()=>ce,ef:()=>ie,nc:()=>l,BX:()=>u,Rx:()=>X,_g:()=>V,Z3:()=>Q,RO:()=>H,iK:()=>v,UP:()=>a,h:()=>i});var r=t(9474);const o=e=>{const[n,t]=(0,r.useState)(e);return[n,(0,r.useCallback)((e=>{t(null==e?e=>!e:"boolean"==typeof e||"function"==typeof e?e:!!e)}),[])]},a=(e,n)=>{const t=(0,r.useRef)(!1);(0,r.useEffect)((()=>{if(t.current)return e();t.current=!0}),n)},s=(e,n)=>e===n,i=(e,n,t)=>{const{isEqual:o=s}=t||{},[i,c]=(0,r.useState)(e);return a((()=>{o(e,i)||null==n||n(i)}),[i]),a((()=>{o(e,i)||c(e)}),[e]),[i,c]},c=(e={})=>{const[n]=(0,r.useState)(e),[t,o]=(0,r.useState)(n),a=(0,r.useCallback)((()=>{o(n)}),[n]),s=(0,r.useCallback)((e=>{o((n=>Object.assign(Object.assign({},n||{}),"function"==typeof e?e(n):e||{})))}),[]);return[t,{setOption:o,reset:a,update:s}]},u=e=>{const n=(0,r.useRef)(e);return n.current=e,n},l=(e,n=[])=>{const t=u(e);return(0,r.useCallback)(((...e)=>t.current(...e)),n)},d=()=>{const e=(0,r.useRef)(!1);return(0,r.useEffect)((()=>(e.current=!0,()=>{e.current=!1})),[]),(0,r.useCallback)((()=>e.current),[])},f=()=>{const e=(0,r.useRef)(!0);return(0,r.useEffect)((()=>(e.current=!1,()=>{e.current=!0})),[]),(0,r.useCallback)((()=>e.current),[])},p=e=>{(0,r.useState)(e)},m=e=>{(0,r.useEffect)(e,[])},v=e=>{const n=u(e);(0,r.useEffect)((()=>()=>{n.current()}),[])},h=(e,n=[],t)=>(0,r.useCallback)((n=>{var r;return"AbortError"===n.name?null===(r=null==t?void 0:t.onAbort)||void 0===r?void 0:r.call(t,n):e(n)}),n);const b=function(e){var n=typeof e;return null!=e&&("object"==n||"function"==n)};const g="object"==typeof global&&global&&global.Object===Object&&global;var y="object"==typeof self&&self&&self.Object===Object&&self;const j=g||y||Function("return this")();const x=function(){return j.Date.now()};var k=/\s/;const A=function(e){for(var n=e.length;n--&&k.test(e.charAt(n)););return n};var w=/^\s+/;const S=function(e){return e?e.slice(0,A(e)+1).replace(w,""):e};const T=j.Symbol;var C=Object.prototype,E=C.hasOwnProperty,O=C.toString,P=T?T.toStringTag:void 0;const R=function(e){var n=E.call(e,P),t=e[P];try{e[P]=void 0;var r=!0}catch(a){}var o=O.call(e);return r&&(n?e[P]=t:delete e[P]),o};var D=Object.prototype.toString;const N=function(e){return D.call(e)};var B=T?T.toStringTag:void 0;const I=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":B&&B in Object(e)?R(e):N(e)};const M=function(e){return null!=e&&"object"==typeof e};const U=function(e){return"symbol"==typeof e||M(e)&&"[object Symbol]"==I(e)};var $=/^[-+]0x[0-9a-f]+$/i,_=/^0b[01]+$/i,F=/^0o[0-7]+$/i,W=parseInt;const Y=function(e){if("number"==typeof e)return e;if(U(e))return NaN;if(b(e)){var n="function"==typeof e.valueOf?e.valueOf():e;e=b(n)?n+"":n}if("string"!=typeof e)return 0===e?e:+e;e=S(e);var t=_.test(e);return t||F.test(e)?W(e.slice(2),t?2:8):$.test(e)?NaN:+e};var q=Math.max,J=Math.min;const K=function(e,n,t){var r,o,a,s,i,c,u=0,l=!1,d=!1,f=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function p(n){var t=r,a=o;return r=o=void 0,u=n,s=e.apply(a,t)}function m(e){var t=e-c;return void 0===c||t>=n||t<0||d&&e-u>=a}function v(){var e=x();if(m(e))return h(e);i=setTimeout(v,function(e){var t=n-(e-c);return d?J(t,a-(e-u)):t}(e))}function h(e){return i=void 0,f&&r?p(e):(r=o=void 0,s)}function g(){var e=x(),t=m(e);if(r=arguments,o=this,c=e,t){if(void 0===i)return function(e){return u=e,i=setTimeout(v,n),l?p(e):s}(c);if(d)return clearTimeout(i),i=setTimeout(v,n),p(c)}return void 0===i&&(i=setTimeout(v,n)),s}return n=Y(n)||0,b(t)&&(l=!!t.leading,a=(d="maxWait"in t)?q(Y(t.maxWait)||0,n):a,f="trailing"in t?!!t.trailing:f),g.cancel=function(){void 0!==i&&clearTimeout(i),u=0,r=c=o=i=void 0},g.flush=function(){return void 0===i?s:h(x())},g},L=(e,n,t)=>{const o=l(e);return(0,r.useMemo)((()=>K(((...e)=>{o(...e)}),n,t)),[n,t])};const z=function(e,n,t){var r=!0,o=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return b(t)&&(r="leading"in t?!!t.leading:r,o="trailing"in t?!!t.trailing:o),K(e,n,{leading:r,maxWait:n,trailing:o})},V=(e,n,t)=>{const o=l(e);return(0,r.useMemo)((()=>z(((...e)=>{o(...e)}),n,t)),[n,t])},X=()=>{const e=f();return(0,r.useCallback)(((n,t)=>{e()?null==t||t():n()}),[])},Z={immediate:!1,catchParam:!1},G=(e,n=Z)=>{const[t,o]=(0,r.useState)(),[a,s]=(0,r.useState)(n.defParam||{}),[i,c]=(0,r.useState)(!1),[u,d]=(0,r.useState)(),[m,h]=(0,r.useState)(),b=f();(0,r.useEffect)((()=>{if(!m||!n.onAbort)return;const e=n.onAbort;return m.signal.addEventListener("abort",e),()=>{m.signal.removeEventListener("abort",e)}}),[m]);const g=l((t=>{const r=n.catchParam?Object.assign(Object.assign({},a),t||{}):t;c(!0),d(void 0),m&&m.abort();const i=new AbortController;return h(i),e(r,{signal:i.signal}).then((e=>{b()||i.signal.aborted||(o(n.format?n.format(e):e),s(r),c(!1))}),(e=>{if(b()||i.signal.aborted)return Promise.reject(e);d(e),c(!1)})).finally((()=>{b()||h(void 0)}))})),y=l((()=>g(a)));return p((()=>{n.immediate&&g(a)})),v((()=>{m&&m.abort()})),[t,{run:g,refresh:y,loading:i,error:u,param:a,controller:m}]},H=()=>{const e=(0,r.useRef)(),n=(0,r.useCallback)((()=>{e.current&&(window.clearTimeout(e.current),e.current=void 0)}),[]),t=(0,r.useCallback)(((t,r,...o)=>{n(),e.current=window.setTimeout((()=>{e.current=void 0,t(...o)}),r)}),[]);return(0,r.useEffect)((()=>n)),[t,n]},Q=(e,n,...t)=>{const[o,a]=H(),s=l(e);return(0,r.useEffect)((()=>(o(s,n,...t),a)),[s,n,...t]),a},ee=()=>{const e=(0,r.useRef)(),n=(0,r.useCallback)((()=>{e.current&&(window.clearInterval(e.current),e.current=void 0)}),[]),t=(0,r.useCallback)(((t,r,...o)=>{n(),e.current=window.setInterval((()=>{t(...o)}),r)}),[]);return(0,r.useEffect)((()=>n)),[t,n]},ne=(e,n,...t)=>{const[o,a]=ee(),s=l(e);return(0,r.useEffect)((()=>(o(s,n,...t),a)),[s,n,...t]),a};let te=null,re=null;function oe(){te||(re=new Map,te=new window.ResizeObserver((e=>{null==e||e.forEach((e=>{var n;null===(n=null==re?void 0:re.get(null==e?void 0:e.target))||void 0===n||n(e)}))})))}const ae=(e,n)=>{te||oe(),e&&(null==re||re.set(e,n),null==te||te.observe(e))},se=e=>{te||oe(),e&&(null==te||te.unobserve(e),null==re||re.delete(e))},ie=()=>[ae,se],ce=(e,n)=>{const t=(0,r.useCallback)((()=>{e.current&&se(e.current)}),[e.current]);return(0,r.useEffect)((()=>{if(!e.current)return;const t=e.current;return ae(t,n),()=>se(t)}),[e.current,n]),t}},8342:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>h,contentTitle:()=>v,default:()=>y,frontMatter:()=>m,metadata:()=>r,toc:()=>b});const r=JSON.parse('{"id":"hooks/useAsync/index","title":"useAsync","description":"\u5b89\u88c5","source":"@site/docs/hooks/useAsync/index.mdx","sourceDirName":"hooks/useAsync","slug":"/hooks/useAsync/","permalink":"/jelper/docs/hooks/useAsync/","draft":false,"unlisted":false,"editUrl":"https://github.com/apathyjade/jelper/tree/master/packages/docs/hooks/useAsync/index.mdx","tags":[],"version":"current","frontMatter":{"title":"useAsync","sort":1},"sidebar":"tutorialSidebar","previous":{"title":"hooks","permalink":"/jelper/docs/hooks/"},"next":{"title":"useBoolState","permalink":"/jelper/docs/hooks/useBoolState/"}}');var o=t(3274),a=t(4252),s=t(4327),i=t(2962),c=t(9031),u=(t(9474),t(5553)),l=t(1139),d=t(3612);const f=()=>new Promise((e=>{setTimeout((()=>{e("ok")}),1500)})),p=()=>{const[e,n]=(0,d.Yb)(f,{immediate:!0}),[t,r]=(0,d.Yb)(f,{immediate:!1});return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(u.A,{spinning:n.loading,children:["data: ",e||"-"]}),(0,o.jsx)("br",{}),(0,o.jsxs)(u.A,{spinning:r.loading,children:["handleData: ",t||"-",(0,o.jsx)(l.Ay,{onClick:r.run,children:"\u83b7\u53d6\u6570\u636e"})]})]})},m={title:"useAsync",sort:1},v=void 0,h={},b=[{value:"\u5b89\u88c5",id:"\u5b89\u88c5",level:3},{value:"\u5f15\u5165",id:"\u5f15\u5165",level:3},{value:"\u6837\u4f8b",id:"\u6837\u4f8b",level:3},{value:"\u57fa\u7840\u7528\u6cd5",id:"\u57fa\u7840\u7528\u6cd5",level:4},{value:"API",id:"api",level:3},{value:"Interface",id:"interface",level:4}];function g(e){const n={code:"code",h3:"h3",h4:"h4",pre:"pre",...(0,a.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h3,{id:"\u5b89\u88c5",children:"\u5b89\u88c5"}),"\n",(0,o.jsx)(i.A,{name:"@jelper/hooks"}),"\n",(0,o.jsx)(n.h3,{id:"\u5f15\u5165",children:"\u5f15\u5165"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-tsx",children:"import { useAsync } from '@jelper/hooks';\n"})}),"\n",(0,o.jsx)(n.h3,{id:"\u6837\u4f8b",children:"\u6837\u4f8b"}),"\n",(0,o.jsx)(n.h4,{id:"\u57fa\u7840\u7528\u6cd5",children:"\u57fa\u7840\u7528\u6cd5"}),"\n",(0,o.jsx)(s.A,{title:"\u57fa\u7840\u7528\u6cd5",desc:"",text:"\nimport React from 'react';\nimport { Spin, Button } from 'antd';\nimport { useAsync } from '@jelper/hooks';\n\n\nconst fetchData = () => {\n  return new Promise((r) => {\n    setTimeout(() => {\n      r('ok');\n    }, 1500)\n  })\n}\n\nexport default () => {\n  const [data, api] = useAsync(fetchData, { immediate: true });\n\n\n  const [handleData, handleApi] = useAsync(fetchData, { immediate: false });\n  return <>\n     <Spin spinning={api.loading}>\n      data: {data || '-'}\n    </Spin>\n    <br />\n     <Spin spinning={handleApi.loading}>\n      handleData: {handleData || '-'}\n      <Button onClick={handleApi.run}>\u83b7\u53d6\u6570\u636e</Button>\n    </Spin>\n  </>\n};\n",children:(0,o.jsx)(p,{})}),"\n",(0,o.jsx)(n.h3,{id:"api",children:"API"}),"\n",(0,o.jsx)(c.A,{dataSource:[{param:"useAsync",desc:"\u5f02\u6b65\u6267\u884c\u5e2e\u52a9hooks",type:"UseAsync",defValue:"--",version:""}]}),"\n",(0,o.jsx)(n.h4,{id:"interface",children:"Interface"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-tsx",children:"interface Opt<T extends (p: any) => any, R> {\n  defParam?: Parameter<T>; // \u9ed8\u8ba4\u53c2\u6570\n  immediate?: boolean;     // \u662f\u5426\u7acb\u5373\u6267\u884c \u9ed8\u8ba4\uff1afalse\n  format?: (p: ReturnType<T>) => R; // \u683c\u5f0f\u5316\u8fd4\u56de\u6570\u636e\n  catchParam?: boolean;   // \u662f\u5426\u5408\u5e76\u8fd4\u56de\u503c\n  onAbort?: (this: AbortSignal, ev: Event) => any; // \u6267\u884c\u53d6\u6d88\u56de\u8c03\n}\ntype UseAsync<T extends (p: any, opt?: { signal: AbortController['signal'] }) => Promise<any>, R = any> = (\n  asyncFn: T,\n  opt: Opt<T, R> = defOpt\n): [\n  R | undefined,  // \u8fd4\u56de\u6570\u636e\n  {\n    run: (runParam?: Partial<Parameter<T>>) => Promise<void>; // \u6267\u884c\u65b9\u6cd5\n    refresh: () => Promise<void>; // \u4f7f\u7528\u4e0a\u4e00\u6b21 \u53c2\u6570 \u6267\u884c\u65b9\u6cd5\n    loading: boolean; // \u52a0\u8f7d\u72b6\u6001\n    error?: Error; // \u5f02\u5e38\u6570\u636e\n    param: Partial<Parameter<T>>; // \u5f53\u524d\u7ed3\u679c\u53c2\u6570\n    controller: AbortController|undefined; // AbortController\u5b9e\u4f8b\u53ef\u624b\u52a8\u53d6\u6d88\u6267\u884c\u56de\u8c03\n  }\n]\n"})})]})}function y(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(g,{...e})}):g(e)}}}]);