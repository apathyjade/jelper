"use strict";(self.webpackChunk_jelper_website=self.webpackChunk_jelper_website||[]).push([[5228],{5802:(e,n,t)=>{t.d(n,{Yb:()=>A,lC:()=>s,yK:()=>p,d7:()=>k,Um:()=>b,$$:()=>S,Bf:()=>w,aq:()=>d,gt:()=>f,JO:()=>h,xW:()=>c,wY:()=>B,ef:()=>D,nc:()=>i,BX:()=>u,Rx:()=>g,_g:()=>j,Z3:()=>C,RO:()=>y,iK:()=>m,UP:()=>a,h:()=>l});var r=t(9474);const s=e=>{const[n,t]=(0,r.useState)(e);return[n,(0,r.useCallback)((e=>{t(null==e?e=>!e:"boolean"==typeof e||"function"==typeof e?e:!!e)}),[])]},a=(e,n)=>{const t=(0,r.useRef)(!1);(0,r.useEffect)((()=>{if(t.current)return e();t.current=!0}),n)},o=(e,n)=>e===n,l=(e,n,t)=>{const{isEqual:s=o}=t||{},[l,c]=(0,r.useState)(e);return a((()=>{s(e,l)||null==n||n(l)}),[l]),a((()=>{s(e,l)||c(e)}),[e]),[l,c]},c=(e={})=>{const[n]=(0,r.useState)(e),[t,s]=(0,r.useState)(n),a=(0,r.useCallback)((()=>{s(n)}),[n]),o=(0,r.useCallback)((e=>{s((n=>Object.assign(Object.assign({},n||{}),"function"==typeof e?e(n):e||{})))}),[]);return[t,{setOption:s,reset:a,update:o}]},u=e=>{const n=(0,r.useRef)(e);return n.current=e,n},i=(e,n=[])=>{const t=u(e);return(0,r.useCallback)(((...e)=>t.current(...e)),n)},d=()=>{const e=(0,r.useRef)(!1);return(0,r.useEffect)((()=>(e.current=!0,()=>{e.current=!1})),[]),(0,r.useCallback)((()=>e.current),[])},f=()=>{const e=(0,r.useRef)(!0);return(0,r.useEffect)((()=>(e.current=!1,()=>{e.current=!0})),[]),(0,r.useCallback)((()=>e.current),[])},p=e=>{(0,r.useState)(e)},h=e=>{(0,r.useEffect)(e,[])},m=e=>{const n=u(e);(0,r.useEffect)((()=>()=>{n.current()}),[])},b=(e,n=[],t)=>(0,r.useCallback)((n=>{var r;return"AbortError"===n.name?null===(r=null==t?void 0:t.onAbort)||void 0===r?void 0:r.call(t,n):e(n)}),n);var v=t(2935);const k=(e,n,t)=>{const s=i(e);return(0,r.useMemo)((()=>(0,v.debounce)(((...e)=>{s(...e)}),n,t)),[n,t])},j=(e,n,t)=>{const s=i(e);return(0,r.useMemo)((()=>(0,v.throttle)(((...e)=>{s(...e)}),n,t)),[n,t])},g=()=>{const e=f();return(0,r.useCallback)(((n,t)=>{e()?null==t||t():n()}),[])},x={immediate:!1,catchParam:!1},A=(e,n=x)=>{const[t,s]=(0,r.useState)(),[a,o]=(0,r.useState)(n.defParam||{}),[l,c]=(0,r.useState)(!1),[u,d]=(0,r.useState)(),[h,b]=(0,r.useState)(),v=f();(0,r.useEffect)((()=>{if(!h||!n.onAbort)return;const e=n.onAbort;return h.signal.addEventListener("abort",e),()=>{h.signal.removeEventListener("abort",e)}}),[h]);const k=i((t=>{const r=n.catchParam?Object.assign(Object.assign({},a),t||{}):t;c(!0),d(void 0),h&&h.abort();const l=new AbortController;return b(l),e(r,{signal:l.signal}).then((e=>{v()||l.signal.aborted||(s(n.format?n.format(e):e),o(r),c(!1))}),(e=>{if(v()||l.signal.aborted)return Promise.reject(e);d(e),c(!1)})).finally((()=>{v()||b(void 0)}))})),j=i((()=>k(a)));return p((()=>{n.immediate&&k(a)})),m((()=>{h&&h.abort()})),[t,{run:k,refresh:j,loading:l,error:u,param:a,controller:h}]},y=()=>{const e=(0,r.useRef)(),n=(0,r.useCallback)((()=>{e.current&&(window.clearTimeout(e.current),e.current=void 0)}),[]),t=(0,r.useCallback)(((t,r,...s)=>{n(),e.current=window.setTimeout((()=>{e.current=void 0,t(...s)}),r)}),[]);return(0,r.useEffect)((()=>n)),[t,n]},C=(e,n,...t)=>{const[s,a]=y(),o=i(e);return(0,r.useEffect)((()=>(s(o,n,...t),a)),[o,n,...t]),a},w=()=>{const e=(0,r.useRef)(),n=(0,r.useCallback)((()=>{e.current&&(window.clearInterval(e.current),e.current=void 0)}),[]),t=(0,r.useCallback)(((t,r,...s)=>{n(),e.current=window.setInterval((()=>{t(...s)}),r)}),[]);return(0,r.useEffect)((()=>n)),[t,n]},S=(e,n,...t)=>{const[s,a]=w(),o=i(e);return(0,r.useEffect)((()=>(s(o,n,...t),a)),[o,n,...t]),a};let P=null,E=null;function R(){P||(E=new Map,P=new window.ResizeObserver((e=>{null==e||e.forEach((e=>{var n;null===(n=null==E?void 0:E.get(null==e?void 0:e.target))||void 0===n||n(e)}))})))}const T=(e,n)=>{P||R(),e&&(null==E||E.set(e,n),null==P||P.observe(e))},O=e=>{P||R(),e&&(null==P||P.unobserve(e),null==E||E.delete(e))},D=()=>[T,O],B=(e,n)=>{const t=(0,r.useCallback)((()=>{e.current&&O(e.current)}),[e.current]);return(0,r.useEffect)((()=>{if(!e.current)return;const t=e.current;return T(t,n),()=>O(t)}),[e.current,n]),t}},7672:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>b,contentTitle:()=>m,default:()=>j,frontMatter:()=>h,metadata:()=>r,toc:()=>v});const r=JSON.parse('{"id":"hooks/useAsync/index","title":"useAsync","description":"\u5f02\u6b65\u51fd\u6570hooks\uff0c\u65b9\u4fbf\u6570\u636e\u5904\u7406\u548c\u6267\u884c","source":"@site/docs/hooks/useAsync/index.mdx","sourceDirName":"hooks/useAsync","slug":"/hooks/useAsync/","permalink":"/jelper/docs/hooks/useAsync/","draft":false,"unlisted":false,"editUrl":"https://github.com/apathyjade/jelper/tree/master/packages/docs/hooks/useAsync/index.mdx","tags":[],"version":"current","frontMatter":{"title":"useAsync","sort":1},"sidebar":"tutorialSidebar","previous":{"title":"hooks","permalink":"/jelper/docs/hooks/"},"next":{"title":"useBoolState","permalink":"/jelper/docs/hooks/useBoolState/"}}');var s=t(3274),a=t(4252),o=t(6220),l=t(6016),c=t(9721),u=(t(9474),t(5553)),i=t(1139),d=t(5802);const f=()=>new Promise((e=>{setTimeout((()=>{e("ok")}),1500)})),p=()=>{const[e,n]=(0,d.Yb)(f,{immediate:!0}),[t,r]=(0,d.Yb)(f,{immediate:!1});return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(u.A,{spinning:n.loading,children:["data: ",e||"-"]}),(0,s.jsx)("br",{}),(0,s.jsxs)(u.A,{spinning:r.loading,children:["handleData: ",t||"-",(0,s.jsx)(i.Ay,{onClick:r.run,children:"\u83b7\u53d6\u6570\u636e"})]})]})},h={title:"useAsync",sort:1},m=void 0,b={},v=[{value:"\u5b89\u88c5",id:"\u5b89\u88c5",level:3},{value:"\u5f15\u5165",id:"\u5f15\u5165",level:3},{value:"\u6837\u4f8b",id:"\u6837\u4f8b",level:3},{value:"\u57fa\u7840\u7528\u6cd5",id:"\u57fa\u7840\u7528\u6cd5",level:4},{value:"API",id:"api",level:3},{value:"Interface",id:"interface",level:4}];function k(e){const n={code:"code",h3:"h3",h4:"h4",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"\u5f02\u6b65\u51fd\u6570hooks\uff0c\u65b9\u4fbf\u6570\u636e\u5904\u7406\u548c\u6267\u884c"}),"\n","\n",(0,s.jsx)(n.h3,{id:"\u5b89\u88c5",children:"\u5b89\u88c5"}),"\n",(0,s.jsx)(l.A,{name:"@jelper/hooks"}),"\n",(0,s.jsx)(n.h3,{id:"\u5f15\u5165",children:"\u5f15\u5165"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"import { useAsync } from '@jelper/hooks';\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u6837\u4f8b",children:"\u6837\u4f8b"}),"\n",(0,s.jsx)(n.h4,{id:"\u57fa\u7840\u7528\u6cd5",children:"\u57fa\u7840\u7528\u6cd5"}),"\n",(0,s.jsx)(o.A,{title:"\u57fa\u7840\u7528\u6cd5",desc:"",text:"\nimport React from 'react';\nimport { Spin, Button } from 'antd';\nimport { useAsync } from '@jelper/hooks';\n\n\nconst fetchData = () => {\n  return new Promise((r) => {\n    setTimeout(() => {\n      r('ok');\n    }, 1500)\n  })\n}\n\nexport default () => {\n  const [data, api] = useAsync(fetchData, { immediate: true });\n\n\n  const [handleData, handleApi] = useAsync(fetchData, { immediate: false });\n  return <>\n     <Spin spinning={api.loading}>\n      data: {data || '-'}\n    </Spin>\n    <br />\n     <Spin spinning={handleApi.loading}>\n      handleData: {handleData || '-'}\n      <Button onClick={handleApi.run}>\u83b7\u53d6\u6570\u636e</Button>\n    </Spin>\n  </>\n};\n",children:(0,s.jsx)(p,{})}),"\n",(0,s.jsx)(n.h3,{id:"api",children:"API"}),"\n",(0,s.jsx)(c.A,{dataSource:[{param:"useAsync",desc:"\u5f02\u6b65\u6267\u884c\u5e2e\u52a9hooks",type:"UseAsync",defValue:"--",version:""}]}),"\n",(0,s.jsx)(n.h4,{id:"interface",children:"Interface"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"interface Opt<T extends (p: any) => any, R> {\n  defParam?: Parameter<T>; // \u9ed8\u8ba4\u53c2\u6570\n  immediate?: boolean;     // \u662f\u5426\u7acb\u5373\u6267\u884c \u9ed8\u8ba4\uff1afalse\n  format?: (p: ReturnType<T>) => R; // \u683c\u5f0f\u5316\u8fd4\u56de\u6570\u636e\n  catchParam?: boolean;   // \u662f\u5426\u5408\u5e76\u8fd4\u56de\u503c\n  onAbort?: (this: AbortSignal, ev: Event) => any; // \u6267\u884c\u53d6\u6d88\u56de\u8c03\n}\ntype UseAsync<T extends (p: any, opt?: { signal: AbortController['signal'] }) => Promise<any>, R = any> = (\n  asyncFn: T,\n  opt: Opt<T, R> = defOpt\n): [\n  R | undefined,  // \u8fd4\u56de\u6570\u636e\n  {\n    run: (runParam?: Partial<Parameter<T>>) => Promise<void>; // \u6267\u884c\u65b9\u6cd5\n    refresh: () => Promise<void>; // \u4f7f\u7528\u4e0a\u4e00\u6b21 \u53c2\u6570 \u6267\u884c\u65b9\u6cd5\n    loading: boolean; // \u52a0\u8f7d\u72b6\u6001\n    error?: Error; // \u5f02\u5e38\u6570\u636e\n    param: Partial<Parameter<T>>; // \u5f53\u524d\u7ed3\u679c\u53c2\u6570\n    controller: AbortController|undefined; // AbortController\u5b9e\u4f8b\u53ef\u624b\u52a8\u53d6\u6d88\u6267\u884c\u56de\u8c03\n  }\n]\n"})})]})}function j(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(k,{...e})}):k(e)}}}]);